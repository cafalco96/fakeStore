<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Registro</title>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body class="bg-[#121212] flex flex-col gap-8 items-center justify-center min-h-screen px-3">
    <button
      type="button"
      aria-label="Abrir modal"
      id="logo"
      class="w-32 h-32 overflow-hidden rounded shadow-[0_0_10px_rgba(245,245,245,0.5)] cursor-pointer"
    >
      <img
        class="w-full h-full object-cover"
        src="./assets/images/descarga.jpeg"
        alt="Logo"
      />
    </button>
    <form
      id="register-form"
      class="bg-[#F5F5F5] shadow-[0_0_10px_rgba(245,245,245,0.5)] rounded px-8 py-6 w-full max-w-sm"
    >
      <h2 class="text-2xl font-bold mb-4 text-center text-[#1E1E1E]">
        Crear Cuenta
      </h2>
      <label class="block mb-2 text-sm font-medium text-[#4B4B4B]">Nombre</label>
      <input
        type="text"
        id="name"
        required
        class="w-full px-3 py-2 border rounded mb-4 text-[#4B4B4B]"
      />
      <label class="block mb-2 text-sm font-medium text-[#4B4B4B]">Email</label>
      <input
        type="email"
        id="email"
        required
        class="w-full px-3 py-2 border rounded mb-4 text-[#4B4B4B]"
      />
      <label class="block mb-2 text-sm font-medium text-[#4B4B4B]">ContraseÃ±a</label>
      <div class="relative mb-4">
        <input
          type="password"
          id="password"
          required
          minlength="8"
          class="w-full px-3 py-2 border rounded text-[#4B4B4B] pr-10"
        />
        <button
          type="button"
          id="toggle-password"
          tabindex="-1"
          class="absolute right-2 top-1/2 -translate-y-1/2 text-[#4B4B4B] focus:outline-none"
          aria-label="Mostrar u ocultar contraseÃ±a"
        >
          ğŸ‘ï¸
        </button>
      </div>
      <label class="block mb-2 text-sm font-medium text-[#4B4B4B]">Confirmar ContraseÃ±a</label>
      <div class="relative mb-4">
        <input
          type="password"
          id="password_confirmation"
          required
          minlength="8"
          class="w-full px-3 py-2 border rounded text-[#4B4B4B] pr-10"
        />
        <button
          type="button"
          id="toggle-password-confirm"
          tabindex="-1"
          class="absolute right-2 top-1/2 -translate-y-1/2 text-[#4B4B4B] focus:outline-none"
          aria-label="Mostrar u ocultar contraseÃ±a"
        >
          ğŸ‘ï¸
        </button>
      </div>
      <button
        type="submit"
        class="w-full bg-[#121212] text-[#F5F5F5] hover:bg-[#333333] transition py-2 rounded"
      >
        Registrarse
      </button>
      <p id="mensaje" class="text-center mt-4 text-2xl font-bold"></p>
    </form>
    <dialog id="dialog" class="p-0 border-none">
      <div
        class="fixed inset-0 bg-[#1E1E1E]/70 backdrop-blur-sm flex items-center justify-center z-50"
      >
        <div
          class="relative bg-[#F5F5F5] shadow-[0_0_10px_rgba(245,245,245,0.5)] rounded px-8 py-6 w-full max-w-sm"
        >
          <button
            id="close-dialog"
            class="absolute right-3 text-[#1E1E1E] hover:text-[#333] text-xl font-bold cursor-pointer"
            aria-label="Cerrar"
          >
            Ã—
          </button>
          <h2 class="text-2xl font-bold mb-4 text-center text-[#1E1E1E]">
            Bienvenido, crea tu cuenta para encontrar los mejores productos
          </h2>
          <a
            href="./login.html"
            class="text-center text-[#1E1E1E] hover:underline block mt-4"
            >Â¿Ya tienes una cuenta? Inicia sesiÃ³n aquÃ­</a>
            <a
              href="./index.html"
              class="block mt-4 text-center bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700 transition"
            >
              Volver al inicio
            </a>
          <p id="dialog-message" class="text-center text-[#4B4B4B]"></p>
        </div>
      </div>
    </dialog>
    <script>
      const logo = document.getElementById("logo");
      const dialog = document.getElementById("dialog");
      const closeDialog = document.getElementById("close-dialog");
      dialog.removeAttribute("open");
      logo.addEventListener("click", () => {
        dialog.setAttribute("open", "");
      });
      closeDialog.addEventListener("click", () => {
        dialog.removeAttribute("open");
      });

      const passwordInput = document.getElementById("password");
      const togglePassword = document.getElementById("toggle-password");
      togglePassword.addEventListener("click", () => {
        const type = passwordInput.type === "password" ? "text" : "password";
        passwordInput.type = type;
        togglePassword.textContent = type === "password" ? "ğŸ‘ï¸" : "ğŸ™ˆ";
      });

      const passwordConfirmInput = document.getElementById("password_confirmation");
      const togglePasswordConfirm = document.getElementById("toggle-password-confirm");
      togglePasswordConfirm.addEventListener("click", () => {
        const type = passwordConfirmInput.type === "password" ? "text" : "password";
        passwordConfirmInput.type = type;
        togglePasswordConfirm.textContent = type === "password" ? "ğŸ‘ï¸" : "ğŸ™ˆ";
      });

      document.getElementById("register-form").addEventListener("submit", async (e) => {
        e.preventDefault();
        const name = document.getElementById("name").value;
        const email = document.getElementById("email").value;
        const password = document.getElementById("password").value;
        const password_confirmation = document.getElementById("password_confirmation").value;
        const mensaje = document.getElementById("mensaje");

        if (password !== password_confirmation) {
          mensaje.textContent = "Las contraseÃ±as no coinciden.";
          mensaje.classList.remove("text-green-600");
          mensaje.classList.add("text-red-500");
          return;
        }

        try {
          const response = await fetch("http://127.0.0.1:8000/api/register", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({
              name,
              email,
              password,
              password_confirmation
            }),
          });
          const data = await response.json();
          if (response.ok) {
            mensaje.textContent = "Registro exitoso. Ahora puedes iniciar sesiÃ³n.";
            mensaje.classList.remove("text-red-500");
            mensaje.classList.add("text-green-600");
            setTimeout(() => {
              window.location.href = "login.html";
            }, 3000); 
          } else {
            mensaje.textContent = data.message || "Error al registrar usuario";
            mensaje.classList.remove("text-green-600");
            mensaje.classList.add("text-red-500");
          }
        } catch (error) {
          mensaje.textContent = "Error al conectar con el servidor";
          mensaje.classList.remove("text-green-600");
          mensaje.classList.add("text-red-500");
        }
      });
    </script>
    <script src="app.js"></script>
  </body>
</html>
